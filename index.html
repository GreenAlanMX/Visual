<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard Integrado D3.js</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 10px;
    background: #f9f9f9;
  }
  .chart-container {
    margin-bottom: 30px;
  }
  svg {
    border: 1px solid #ccc;
    background: lightgrey;
  }
  p.description {
    text-align: center;
    margin-top: 10px;
  }
  #dragdrop circle {
    cursor: grab;
  }
  #coords {
    cursor: crosshair;
  }
  #brush1, #brush2 {
    margin-right: 20px;
  }
  #brush-container {
    display: flex;
    gap: 20px;
  }
</style>
</head>
<body>

  <!-- 1. Drag & Drop Circles -->
  <div class="chart-container">
    <h2>Drag & Drop Circles</h2>
    <svg id="dragdrop" width="600" height="200"></svg>
  </div>

  <!-- 2. Staggered Bars Animation -->
  <div class="chart-container">
    <h2>Staggered Bars Animation (clic para animar)</h2>
    <svg id="stagger" width="600" height="300"></svg>
    <p class="description">Click on the chart to see the staggered animation effect!</p>
  </div>

  <!-- 3. Lissajous Curve -->
  <div class="chart-container">
    <h2>Lissajous Curve Animation</h2>
    <svg id="lissajous" width="300" height="300"></svg>
  </div>

  <!-- 4. Mostrar Coordenadas del Mouse -->
  <div class="chart-container">
    <h2>Mostrar Coordenadas del Mouse</h2>
    <svg id="coords" width="300" height="300"></svg>
  </div>

  <!-- 5. Brush Circles -->
  <div class="chart-container" id="brush-container">
    <div>
      <h2>Brush 1</h2>
      <svg id="brush1" width="300" height="300"></svg>
    </div>
    <div>
      <h2>Brush 2</h2>
      <svg id="brush2" width="300" height="300"></svg>
    </div>
  </div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
  // 1. Drag & Drop Circles
  (function() {
    const svg = d3.select("#dragdrop");
    svg.selectAll("circle")
      .data([
        {cx:100, cy:100, r:20, fill:"black"},
        {cx:300, cy:100, r:20, fill:"purple"},
        {cx:500, cy:100, r:20, fill:"yellow"}
      ])
      .enter()
      .append("circle")
      .attr("cx", d=>d.cx)
      .attr("cy", d=>d.cy)
      .attr("r", d=>d.r)
      .attr("fill", d=>d.fill)
      .call(d3.drag()
        .on("start", function(event, d) {
          d3.select(this).attr("fill", "lime");
        })
        .on("drag", function(event, d) {
          d3.select(this).attr("cx", event.x).attr("cy", event.y);
        })
        .on("end", function(event, d) {
          d3.select(this).attr("fill", d.fill);
        })
      );
  })();

  // 2. Staggered Bars Animation
  (function() {
    const ds1 = [2, 1, 3, 5, 7, 8, 9, 9, 9, 8, 7, 5, 3, 1, 2];
    const ds2 = [8, 9, 8, 7, 5, 3, 2, 1, 2, 3, 5, 7, 8, 9, 8];
    let currentData = ds1.slice();

    const n = ds1.length;
    const mx = d3.max([...ds1, ...ds2]);

    const svg = d3.select("#stagger");
    const scX = d3.scaleLinear().domain([0, n-1]).range([50, 540]);
    const scY = d3.scaleLinear().domain([0, mx]).range([250, 50]);

    svg.selectAll("line")
      .data(currentData)
      .enter()
      .append("line")
      .attr("stroke", "red")
      .attr("stroke-width", 20)
      .attr("x1", (d,i) => scX(i))
      .attr("y1", scY(0))
      .attr("x2", (d,i) => scX(i))
      .attr("y2", d => scY(d));

    svg.on("click", function() {
      currentData = (currentData === ds1) ? ds2 : ds1;
      svg.selectAll("line")
        .data(currentData)
        .transition()
        .duration(1000)
        .delay((d,i) => 200*i)
        .attr("y2", d => scY(d));
    });
  })();

  // 3. Lissajous Curve Animation
  (function() {
    const svg = d3.select("#lissajous");
    const a = 1.9, b = 3.2;
    const omega = 2 * Math.PI / 10000; // 10s per period
    let prvX = 150 + 100, prvY = 150;

    const timer = d3.timer(function(t) {
      const phi = omega * t;
      const crrX = 150 + 100 * Math.cos(a * phi);
      const crrY = 150 + 100 * Math.sin(b * phi);

      svg.selectAll("line")
        .each(function() { this.bogus_opacity *= 0.99; })
        .attr("stroke-opacity", function() { return this.bogus_opacity; })
        .filter(function() { return this.bogus_opacity < 0.05; })
        .remove();

      svg.append("line")
        .each(function() { this.bogus_opacity = 1.0; })
        .attr("x1", prvX).attr("y1", prvY)
        .attr("x2", crrX).attr("y2", crrY)
        .attr("stroke", "green").attr("stroke-width", 2);

      prvX = crrX;
      prvY = crrY;

      if (t > 120000) timer.stop(); // Stop after 120s
    });
  })();

  // 4. Mostrar Coordenadas del Mouse
  (function() {
    const svg = d3.select("#coords");
    const txt = svg.append("text")
      .attr("font-family", "Arial, sans-serif")
      .attr("font-size", 12)
      .attr("fill", "black");

    svg.attr("cursor", "crosshair")
      .on("mousemove", function(event) {
        const pt = d3.pointer(event, svg.node());
        txt.attr("x", pt[0] + 18)
          .attr("y", pt[1] + 6)
          .text(`(${Math.round(pt[0])}, ${Math.round(pt[1])})`);
      })
      .on("mouseleave", () => txt.text(""));
  })();

  // 5. Brush Circles
  (function() {
    // Ejemplo de datos (reemplaza con los tuyos o carga JSON real)
    const data = [
      {A: 5, B: 10},
      {A: 10, B: 20},
      {A: 15, B: 5},
      {A: 7, B: 25},
      {A: 12, B: 15}
    ];

    function drawCircles(svg, data, accX, accY, sc) {
      return svg.selectAll("circle")
        .data(data)
        .enter()
        .append("circle")
        .attr("r", 5)
        .attr("cx", d => accX(d))
        .attr("cy", d => accY(d))
        .attr("fill", sc(Infinity))
        .attr("fill-opacity", 0.4);
    }

    function installHandlers(svg, data, cs1, cs2, sc1, sc2) {
      svg.attr("cursor", "crosshair")
        .on("mousemove", function(event) {
          const pt = d3.pointer(event, svg.node());
          cs1.attr("fill", function(d, i) {
            const r = Math.hypot(pt[0] - d3.select(this).attr("cx"), pt[1] - d3.select(this).attr("cy"));
            data[i].r = r;
            return sc1(r);
          });
          cs2.attr("fill", (d, i) => sc2(data[i].r));
        })
        .on("mouseleave", function() {
          cs1.attr("fill", sc1(Infinity));
          cs2.attr("fill", sc2(Infinity));
        });
    }

    const svg1 = d3.select("#brush1");
    const svg2 = d3.select("#brush2");

    const sc1 = d3.scaleLinear()
      .domain([0, 10, 50])
      .range(["lime", "yellow", "red"]);

    const sc2 = d3.scaleLinear()
      .domain([0, 10, 50])
      .range(["lime", "yellow", "blue"]);

    const cs1 = drawCircles(svg1, data, d => +d.A, d => +d.B, sc1);
    const cs2 = drawCircles(svg2, data, d => +d.A, d => +d.B, sc2);

    installHandlers(svg1, data, cs1, cs2, sc1, sc2);
  })();

</script>
</body>
</html>
